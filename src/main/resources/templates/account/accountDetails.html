<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" lang="en"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/layout}" th:with="showBack=true">
<head>
  <title>Your Account Details</title>
</head>
<body>
<div layout:fragment="content" class="govuk-grid-column-full">

  <div role="alert">
    <h1 class="govuk-heading-l">Your account details</h1>
  </div>
  <div th:if="${authUser.authSource != 'azuread'}" >
    <p class="govuk-body">
      <a class="govuk-link govuk-link--no-visited-state" th:href="@{/existing-password}" data-qa="changePassword">
        Change your password
      </a>
    </p>
  </div>
  <dl class="govuk-summary-list">
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Name
      </dt>
      <dd class="govuk-summary-list__value" data-qa="name" th:text="${user.name}">
        Sarah Philips
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/change-name}"
           th:if="${authUser.authSource == 'auth'}" data-qa="changeName">
          Change<span class="govuk-visually-hidden"> name</span>
        </a>
      </dd>
    </div>
    <div class="govuk-summary-list__row" th:if="${authUser.authSource != 'azuread'}">
      <dt class="govuk-summary-list__key">
        Username
      </dt>
      <dd class="govuk-summary-list__value" data-qa="username" th:text="${authUser.username}">
        ABC12D
      </dd>
      <dd class="govuk-summary-list__actions">
        &nbsp;
      </dd>
    </div>
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Last signed in
      </dt>
      <dd class="govuk-summary-list__value" data-qa="lastLoggedIn"
          th:text="${#temporals.format(authUser.lastLoggedIn, 'd MMMM yyyy, HH:mm')}">
        24 January 2020 - 10:00:13
      </dd>
      <dd class="govuk-summary-list__actions">
        &nbsp;
      </dd>
    </div>
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Email address
      </dt>
      <dd class="govuk-summary-list__value" data-qa="email" th:text="${authUser.email}">
        sarah.philips@digital.justice.gov.uk
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/existing-email}"
           th:if="${authUser.authSource != 'delius' && authUser.authSource != 'azuread'}"
           data-qa="changeEmail">
          <th:block th:text="${#strings.isEmpty(authUser.email)} ? 'Add' : 'Change'">
            Change
          </th:block>
          <span class="govuk-visually-hidden"> email</span>
        </a>
      </dd>
    </div>
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Verified email
      </dt>
      <dd class="govuk-summary-list__value" data-qa="verified" th:text="${authUser.verified} ? 'Yes' : 'No'">
        Yes
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/verify-email}"
           th:unless="${#strings.isEmpty(authUser.email) || authUser.verified}"
           data-qa="verifyEmail">
          Resend <span class="govuk-visually-hidden"> email</span> code
        </a>
      </dd>
    </div>
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Backup email
      </dt>
      <dd class="govuk-summary-list__value" data-qa="secondaryEmail" th:text="${authUser.secondaryEmail}">
        bob@digital.justice.gov.uk
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/new-backup-email}"
           data-qa="changeSecondaryEmail">
          <th:block th:text="${#strings.isEmpty(authUser.secondaryEmail)} ? 'Add' : 'Change'">
            Change
          </th:block>
          <span class="govuk-visually-hidden"> backup email</span>
        </a>
      </dd>
    </div>
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Verified backup email
      </dt>
      <dd class="govuk-summary-list__value" data-qa="verifiedSecondaryEmail"
          th:text="${authUser.secondaryEmailVerified} ? 'Yes' : 'No'">
        Yes
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/backup-email-resend}"
           th:unless="${#strings.isEmpty(authUser.secondaryEmail) || authUser.secondaryEmailVerified}"
           data-qa="verifySecondaryEmail">
          Resend <span class="govuk-visually-hidden">backup email</span> code
        </a>
      </dd>
    </div>
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Mobile number
      </dt>
      <dd class="govuk-summary-list__value" data-qa="mobile" th:text="${authUser.mobile}">
        01234 567890
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/change-mobile}" data-qa="changeMobile">
          <th:block th:text="${#strings.isEmpty(authUser.mobile)} ? 'Add' : 'Change'">
            Change
          </th:block>
          <span class="govuk-visually-hidden"> mobile number</span>
        </a>
      </dd>
    </div>
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Verified mobile
      </dt>
      <dd class="govuk-summary-list__value" data-qa="mobileVerified"
          th:text="${authUser.mobileVerified} ? 'Yes' : 'No'">
        No
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/mobile-resend}"
           th:unless="${#strings.isEmpty(authUser.mobile) || authUser.mobileVerified}"
           data-qa="verifyMobile">
          Resend <span class="govuk-visually-hidden"> mobile</span> code
        </a>
      </dd>
    </div>
    <div th:class="govuk-summary-list__row">
      <dt th:class="'govuk-summary-list__key' + (${!mfaPreferenceVerified} ? ' govuk-form-group--error' : '')">
        2-step verification
      </dt>
      <dd class="govuk-summary-list__value" data-qa="mfaPreference">
        <span th:text="#{${'mfa.preference.' + authUser.mfaPreference}}">
           None
        </span>
        <span th:if="${!mfaPreferenceVerified}"
              id="mfa-preference-not-verified-error" class="govuk-error-message"
              th:text="'Selection has not been verified'">
          preference
        </span>
      </dd>
      <dd class="govuk-summary-list__actions">
        <a class="govuk-link govuk-link--no-visited-state" th:href="@{/mfa-preference}" data-qa="changeMfaPreference">
          Change <span class="govuk-visually-hidden"> 2-step verification preference</span>
        </a>
      </dd>
    </div>
  </dl>

  <div th:if="${#lists.size(linkedAccounts) > 0}" >
    <div role="alert" data-qa="linkedAccountsHeading">
      <h1 class="govuk-heading-l">Your linked accounts</h1>
    </div>
    <dl class="govuk-summary-list" th:each="account, iter : ${linkedAccounts}" data-qa="linkedAccount">
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          System
        </dt>
        <dd class="govuk-summary-list__value" th:attr="data-qa='system-'+${iter.index}" th:text="${account.systemName}">
          NOMIS
        </dd>
      </div>
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Username
        </dt>
        <dd class="govuk-summary-list__value" th:attr="data-qa='username-'+${iter.index}" th:text="${account.username}">
          TEST_USER
        </dd>
      </div>
    </dl>
  </div>
</div>
</body>
</html>
