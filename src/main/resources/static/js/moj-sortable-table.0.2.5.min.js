MOJFrontend.SortableTable=function(params){this.table=$(params.table),this.table.data("moj-search-toggle-initialised")||(this.table.data("moj-search-toggle-initialised",!0),this.setupOptions(params),this.body=this.table.find("tbody"),this.createHeadingButtons(),this.createStatusBox(),this.table.on("click","th button",$.proxy(this,"onSortButtonClick")))},MOJFrontend.SortableTable.prototype.setupOptions=function(params){this.statusMessage=(params=params||{}).statusMessage||"Sort by %heading% (%direction%)",this.ascendingText=params.ascendingText||"ascending",this.descendingText=params.descendingText||"descending"},MOJFrontend.SortableTable.prototype.createHeadingButtons=function(){for(var heading,headings=this.table.find("thead th"),i=0;i<headings.length;i++)(heading=$(headings[i])).attr("aria-sort")&&this.createHeadingButton(heading,i)},MOJFrontend.SortableTable.prototype.createHeadingButton=function(heading,i){var button=heading.text(),button=$('<button type="button" data-index="'+i+'">'+button+"</button>");heading.text(""),heading.append(button)},MOJFrontend.SortableTable.prototype.createStatusBox=function(){this.status=$('<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden" />'),this.table.parent().append(this.status)},MOJFrontend.SortableTable.prototype.onSortButtonClick=function(e){var sortedRows=e.currentTarget.getAttribute("data-index"),rows=$(e.currentTarget).parent().attr("aria-sort"),newSortDirection="none"===rows||"descending"===rows?"ascending":"descending",rows=this.getTableRowsArray(),sortedRows=this.sort(rows,sortedRows,newSortDirection);this.addRows(sortedRows),this.removeButtonStates(),this.updateButtonState($(e.currentTarget),newSortDirection)},MOJFrontend.SortableTable.prototype.updateButtonState=function(button,direction){button.parent().attr("aria-sort",direction);var message=this.statusMessage;message=(message=message.replace(/%heading%/,button.text())).replace(/%direction%/,this[direction+"Text"]),this.status.text(message)},MOJFrontend.SortableTable.prototype.removeButtonStates=function(){this.table.find("thead th").attr("aria-sort","none")},MOJFrontend.SortableTable.prototype.addRows=function(rows){for(var i=0;i<rows.length;i++)this.body.append(rows[i])},MOJFrontend.SortableTable.prototype.getTableRowsArray=function(){for(var rows=[],trs=this.body.find("tr"),i=0;i<trs.length;i++)rows.push(trs[i]);return rows},MOJFrontend.SortableTable.prototype.sort=function(rows,columnNumber,sortDirection){return rows.sort($.proxy(function(valueA,valueB){valueA=$(valueA).find("td").eq(columnNumber),valueB=$(valueB).find("td").eq(columnNumber),valueA=this.getCellValue(valueA),valueB=this.getCellValue(valueB);return"ascending"===sortDirection?valueA<valueB?-1:valueB<valueA?1:0:valueB<valueA?-1:valueA<valueB?1:0},this))},MOJFrontend.SortableTable.prototype.getCellValue=function(cell){var val=(val=cell.attr("data-sort-value"))||cell.html();return val=$.isNumeric(val)?parseInt(val,10):val};
